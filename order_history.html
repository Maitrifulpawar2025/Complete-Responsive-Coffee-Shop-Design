<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Order History</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
    <a href="order.html" class="logo"><img src="images/logo.png" alt="" width="50" height="50"></a>
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">CoffeeShop</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="order.html">Bestseller</a></li>
          <li class="nav-item"><a class="nav-link" href="drink.html#drink-section">Drink</a></li>
          <li class="nav-item"><a class="nav-link" href="food.html">Food</a></li>
          <li class="nav-item"><a class="nav-link active" href="order_history.html">Order History</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h2 class="fw-bold mb-4">Order History</h2>
    <table class="table table-bordered" id="ordersTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Item</th>
          <th>Price (₹)</th>
          <th>Quantity</th>
          <th>Subtotal (₹)</th>
        </tr>
      </thead>
      <tbody>
        <!-- Orders will be loaded here -->
      </tbody>
      <tfoot>
        <tr>
          <th colspan="4" class="text-end">Total</th>
          <th id="orderTotal">₹ 0</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <script>
    fetch('get_orders.php')
      .then(response => response.json())
      .then(data => {
        let tbody = '';
        let total = 0;
        data.forEach((order, idx) => {
          const subtotal = parseFloat(order.price) * parseInt(order.quantity);
          total += subtotal;
          tbody += `<tr>
            <td>${idx + 1}</td>
            <td>${order.item}</td>
            <td>${order.price}</td>
            <td>${order.quantity}</td>
            <td>${subtotal.toFixed(2)}</td>
          </tr>`;
        });
        document.querySelector('#ordersTable tbody').innerHTML = tbody;
        document.getElementById('orderTotal').textContent = '₹ ' + total.toFixed(2);
      })
      .catch(err => {
        document.querySelector('#ordersTable tbody').innerHTML = `<tr><td colspan="5">Failed to load order history.</td></tr>`;
      });
  </script>
</body>
</html>